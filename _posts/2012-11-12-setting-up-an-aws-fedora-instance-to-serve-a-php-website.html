---
layout: post
title: Setting up an AWS Fedora instance to serve a PHP website
date: 2012-11-12
comments: false
legacy: true
---

<h1>{{ page.title }}</h1>
<div class='post'>
<div class="im-ignorant-warning">Warning: I'm not a sysadmin. While I got this working by following the steps below there are probably more secure and maintainable ways to achieve this. </div><br />Here's a step-by-step guide to get a PHP website running on Fedora: <br /><h3>Launch a Fedora instance and connect to it via ssh</h3>I'm using this AMI: Fedora-17-ec2-20120515-i386-sda (ami-08d97e61). You can  find it by selecting "Classic Wizard" in the EC2 launch dialog and going to the "Community AMIs" tab.<br />Before creating the instance AWS will let you download a security key for the instance. <br /><h3>Setting up the EC2 security group too allow ssh and http access</h3>In order to make changes on the machine and allow it to serve web pages to users you need to make sure that the security group assigned to the instance allows this. For ssh you'll need access on port 22, and http access requires access via port 80: <br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-Y0mWBUQQ0GQ/UJ-ruauwVxI/AAAAAAAAADk/2Zqg4Cn9C7U/s1600/ec2-security-groups.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="149" src="http://3.bp.blogspot.com/-Y0mWBUQQ0GQ/UJ-ruauwVxI/AAAAAAAAADk/2Zqg4Cn9C7U/s400/ec2-security-groups.png" width="400" /></a></div><br />If these aren't set up correctly you won't be able to connect via ssh or request a web page from the server.<br /><h3>Accessing the machine via ssh</h3>To connect via ssh you first need to find the public address of the running instance:<br /><br /><a href="http://2.bp.blogspot.com/-tLtQxQ0W1Sw/UJpCHa7zABI/AAAAAAAAADQ/SEHulLd8gCg/s1600/Screen+Shot+2012-11-07+at+10.49.17.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" height="160" src="http://2.bp.blogspot.com/-tLtQxQ0W1Sw/UJpCHa7zABI/AAAAAAAAADQ/SEHulLd8gCg/s400/Screen+Shot+2012-11-07+at+10.49.17.png" width="400" /></a><br /><br />Now you can connect to it like this: <br /><br /><code>ssh -i keyfile.pem ec2-user@ec2-12-345-678-901.compute-1.amazonaws.com&nbsp;</code><br /><br />Say yes if you are asked to confirm the authenticity of the server.<br /><h4>If you get an unprotected key file warning</h4>The ssh program will not allow you to connect to the sever if your keyfile is accessible to other users on your local machine:<br /><br /><code>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @         WARNING: UNPROTECTED PRIVATE KEY FILE!          @ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Permissions 0644 for 'keyfile.pem' are too open. </code><br /><br />You can use chmod to restrict access to these users:<br /><code>chmod og= keyfile.pem  </code><br />This will remove all access permissions for all users who don't own the file - i.e. other members of your group (g) and all other (o) users. <br /><br /><h3>Installing Apache, starting Apache and disabling the firewall</h3>The following commands will download, install and start the Apache server:<br /><pre>sudo yum install httpd -y<br />sudo service httpd start</pre>You can now access the server locally (try "curl localhost"), but iptables is still blocking traffic from other computers. You can remove the firewall restrictions like this:<br /><pre>sudo iptables --flush</pre>Now you can go to the public DNS address you used to log in via ssh to see the test page for Apache on Fedora:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-eSjIqtmhZYM/UKDh-p9uzGI/AAAAAAAAAD0/8V0Ajvg1l8Y/s1600/Screen+Shot+2012-11-12+at+11.42.08.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="270" src="http://3.bp.blogspot.com/-eSjIqtmhZYM/UKDh-p9uzGI/AAAAAAAAAD0/8V0Ajvg1l8Y/s400/Screen+Shot+2012-11-12+at+11.42.08.png" width="400" /></a></div><br /><h3>Serving a custom page</h3><div>You can serve custom content by putting it in the /var/www/html directory. &nbsp;First let's install nano to edit text files, then create a test.php file and put something in it:</div><div><br /></div><code>sudo yum install nano -y <br />cd /var/www/html<br /></code><br /><div><div><code>sudo nano test.php</code></div></div><code></code><br /><div><br /></div><div>Now you can go to whatever.compute-1.amazonaws.com/test.php to see the contents of that file. However, no PHP code in the file will be executed:</div><div><blockquote class="tr_bq">This is a test.<br />&lt;?php phpinfo()&nbsp;?&gt;</blockquote><h3>Installing PHP</h3></div><div>To get PHP working you need to install it and then restart Apache:</div><br /><code>sudo yum install php -y<br />sudo service httpd restart</code><br /><code><br /></code>Now your website should be serving the PHP page correctly:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-etI-_z4v-9w/UKDrCcDerGI/AAAAAAAAAEE/V4f2wCdwGNM/s1600/Screen+Shot+2012-11-12+at+12.25.58.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="268" src="http://4.bp.blogspot.com/-etI-_z4v-9w/UKDrCcDerGI/AAAAAAAAAEE/V4f2wCdwGNM/s400/Screen+Shot+2012-11-12+at+12.25.58.png" width="400" /></a></div><br />Your server can now serve simple PHP code. You might also need to s<a href="http://blog.mostlystatic.com/2012/11/setting-up-mysql-on-awsfedora.html">et up a MySql database</a>.<br /><br /></div>
<h2>Comments</h2>
<div class='comments'>
</div>
