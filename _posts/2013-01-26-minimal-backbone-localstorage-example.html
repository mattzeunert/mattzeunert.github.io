---
layout: post
title: Minimal Backbone.localStorage example
date: 2013-01-26
comments: false
legacy: true
---

<h1>{{ page.title }}</h1>
<div class='post'>
I struggled to get Backbone.localStorage working, mostly due to this <a href="http://blog.mostlystatic.com/2013/01/backbone-localstorage-uncaught.html">"Object has no method 'parse'" error</a>. Below is a minimal example without views, you can<a href="https://github.com/mostlystatic/minmal-Backbone.localStorage-example"> download the full code from Github</a>.<br /><h3>The Model and the Collection</h3><div>In order to use Backbone.localStorage to save a model we also need a collection. The `localStorage` property of the collection needs to be set to a new Backbone.LocalStorage object with an identifier for the collection that is used when reading or writing the model values to LocalStorage.</div><div><pre class="brush: javascript">var Note = Backbone.Model.extend({<br />    defaults: function(){<br />        return {<br />            content: "Note created on " + new Date().toISOString()<br />        }<br />    }<br />});<br /><br />var NoteCollection = Backbone.Collection.extend({<br />    model: Note,<br />    localStorage: new Backbone.LocalStorage("choose-some-identifier")<br />});</pre></div><div>The defaults function of the model returns an object with a content property that makes it easy to identify when the model was added to the collection and if it's new or has been fetched from local storage.</div><h3>Adding and saving Note models</h3><div>Backbone collections have a <a href="http://backbonejs.org/#Collection-fetch">fetch method</a> that retrieves models from the server or, in this case, local storage.<br />Before calling <a href="http://backbonejs.org/#Model-save">save</a> on the model we need to add it to the collection, otherwise Backbone would attempt to use an Http request to store it on a server.</div><div><pre class="brush: javascript">var myNotes = new NoteCollection();<br />myNotes.fetch();<br />var note1 = new Note();<br />myNotes.add(note1);<br />note1.save();<br /><br />myNotes.models.forEach(function(model){<br />    console.log("Model in collection: " + model.get("content"));<br />});</pre></div><div>After loading the page a few times the console output might look like this:</div><div><pre>Model in collection: Note created on 2013-01-22T12:25:33.735Z<br />Model in collection: Note created on 2013-01-22T12:25:34.897Z<br />Model in collection: Note created on 2013-01-22T12:25:40.786Z<br />Model in collection: Note created on 2013-01-22T12:27:42.161Z</pre></div><div>In local storage the models are stored like this:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-p93B9E3kj0M/UP6LjEf5o5I/AAAAAAAAAF8/IUMagDMHnBc/s1600/Screen+Shot+2013-01-22+at+12.52.08.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-p93B9E3kj0M/UP6LjEf5o5I/AAAAAAAAAF8/IUMagDMHnBc/s1600/Screen+Shot+2013-01-22+at+12.52.08.png" /></a></div><br /></div></div>
<h2>Comments</h2>
<div class='comments'>
</div>
